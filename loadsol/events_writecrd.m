clearclcclose all%%%for files P_01 slineOE_05; P_03 slineOE_01; P_12 slineOE_01 use events_writecrd_ind.m%%% files P_01 tr_06; P_06 tr_66 events cleared in MOKKA%%%pkg load signal %signal package is needed for filter functions-->has to be downloaded (pkg install -forge signal)%%% for a working Code you need to install the ezc3d add on from matlab and%%% compile it with CMake on your Computer for detailed information watch%%% this video: https://www.youtube.com/watch?v=gWno_NXrITA%%% you also might need the mingw for compiling in VS for that watch this%%% webside: https://www.msys2.org/% add functions pathfunctionsPath = addpath(genpath('C:\Users\jpeic\OneDrive\Documents\A_University\M_Rehatechnik\A_Masterarbeit\Code\Synergies\loadsol\')); %folder with skript and functionsezc3dPath = addpath('C:\Users\jpeic\AppData\Roaming\MathWorks\MATLAB Add-Ons\Collections\ezc3d');% directory of the folder with the raw c3d and loasol data for each participantdata_folder = ['C:\Users\jpeic\OneDrive\Documents\A_University\M_Rehatechnik\A_Masterarbeit\Pilot_Study\Pilot_Alex\Pilot_all\'];save_folder = ['C:\Users\jpeic\OneDrive\Documents\A_University\M_Rehatechnik\A_Masterarbeit\Pilot_Study\Pilot_Alex\Pilot_test\'];cd (save_folder);soles = load('soles.mat'); soles = soles.soles;% soles = rmfield(soles, {'P_04','P_09'});probands = fieldnames(soles);nr_prb = length(probands);for prb = 1:nr_prb  clear trialnames  proband = probands{prb}  soletrials = fieldnames(soles.(proband)); %trials of proband in soles struct  nr_strl = length(soletrials);    for strl = 1:nr_strl;    [solesevents.(proband).(soletrials{strl}).con, solesevents.(proband).(soletrials{strl}).off, nozeros] = det_contacts(soles.(proband).(soletrials{strl}), 'R_total', 'gen_th', 30, 'min_cycle', 200, 'max_cycle', 10000, 'transmission_error', 2, 'cycle_th', 100);  end%for  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%  cd ([data_folder, proband, '/c3d']); %folder with raw c3dfiles    c3dnames_1  = dir([data_folder, proband, '/c3d']);%gets names of c3d files  c3dnames    = c3dnames_1((3:length(c3dnames_1)),1);  nr_c3d      = length(c3dnames);  a=1;for c3 = 1:nr_c3d  % Start from index 3 to skip '.' and '..' entries    searchString = {'static', 'MVC', 'EMG'};    found = false;        % Get the current file name from the structure    currentFileName = c3dnames(c3).name;        % Loop through each search string and check if it exists in the file name    for i = 1:numel(searchString)        if ~isempty(strfind(currentFileName, searchString{i}))            found = true;            break; % Exit the loop early if a match is found        end    end    % Check if none of the search strings were found    if ~found        trialnames{a, 1} = currentFileName(1:end-4);        a = a+1;    endend  nr_trl = length(trialnames);    for trl = 1:nr_trl    trial = trialnames{trl};        con = solesevents.(proband).(trial).con;    off = solesevents.(proband).(trial).off;        file = ezc3dRead([trial, '.c3d']);        original_events = getEventTimes(file, 'Foot Strike', 'Right', 2);    condelay = con(1) - original_events(1);    contimes = con - condelay;    offtimes = off - condelay;        eventsfile = setEventTimes(file, contimes, 'Foot Strike', 'Right', 'overwrite', 1, 'intime', 1);    eventsfile = setEventTimes(eventsfile, offtimes, 'Foot Off', 'Right', 'overwrite', 0, 'intime', 1);        cd ([save_folder, proband,'/new']);    ezc3dWrite(trial, eventsfile);    cd ([data_folder, proband, '/c3d']); %folder with raw c3dfiles  end%for    clear c3dnames_1 probandend%for  